<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>telRSSRadar ÁÆ°ÁêÜÈù¢Êùø</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #8E8E93;
            --success-color: #34C759;
            --danger-color: #FF3B30;
            --warning-color: #FF9500;
            --info-color: #5AC8FA;
            --dark-color: #1C1C1E;
            --light-color: #F2F2F7;
            --sidebar-width: 260px;
            --header-height: 64px;

            /* Light mode colors */
            --bg-primary: #F2F2F7;
            --bg-secondary: rgba(255, 255, 255, 0.8);
            --bg-card: #FFFFFF;
            --text-primary: #1C1C1E;
            --text-secondary: #8E8E93;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-color: rgba(0, 0, 0, 0.04);
            --hover-bg: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode {
            --bg-primary: #000000;
            --bg-secondary: rgba(28, 28, 30, 0.8);
            --bg-card: #1C1C1E;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-bg: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
            background: var(--bg-primary);
            background-image:
                radial-gradient(at 0% 0%, rgba(0, 122, 255, 0.03) 0%, transparent 50%),
                radial-gradient(at 100% 100%, rgba(52, 199, 89, 0.02) 0%, transparent 50%);
            color: var(--text-primary);
            line-height: 1.47;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--bg-secondary);
            backdrop-filter: saturate(180%) blur(40px);
            -webkit-backdrop-filter: saturate(180%) blur(40px);
            padding: 20px 0;
            border-right: 0.5px solid var(--border-color);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 8px 32px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            overflow-y: auto;
        }

        body.dark-mode .sidebar {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.05) inset,
                0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .sidebar-brand {
            padding: 0 24px 24px;
            border-bottom: 0.5px solid var(--border-color);
            margin-bottom: 16px;
        }

        .sidebar-brand h2 {
            color: var(--text-primary);
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
        }

        .sidebar-brand small {
            display: block;
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 4px;
            font-weight: 400;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0 12px;
        }

        .sidebar-menu li {
            margin-bottom: 2px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            font-weight: 400;
        }

        .sidebar-menu a:hover {
            background: var(--hover-bg);
        }

        .sidebar-menu a.active {
            background: #007AFF;
            color: white;
            font-weight: 500;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 2px 8px rgba(0, 122, 255, 0.3),
                0 4px 16px rgba(0, 122, 255, 0.2);
        }

        .sidebar-menu a i {
            width: 20px;
            margin-right: 12px;
            font-size: 17px;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Top Header */
        .top-header {
            background: var(--bg-card);
            backdrop-filter: saturate(180%) blur(40px);
            -webkit-backdrop-filter: saturate(180%) blur(40px);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            border-bottom: 0.5px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 1px 0 rgba(0, 0, 0, 0.05),
                0 4px 12px rgba(0, 0, 0, 0.04);
        }

        body.dark-mode .top-header {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.08) inset,
                0 1px 0 rgba(0, 0, 0, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #mobile-dark-mode-toggle {
            display: none;
        }

        .header-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-btn.primary {
            background: #007AFF;
            color: white;
        }

        .header-btn.primary:hover {
            background: #0051D5;
            transform: translateY(-1px);
        }

        .header-btn.primary:active {
            transform: scale(0.98);
        }

        /* Content Area */
        .content-area {
            padding: 32px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 24px;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 1px 3px var(--shadow-color),
                0 4px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 0.5px solid var(--border-color);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .stat-card {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.08) inset,
                0 1px 3px var(--shadow-color),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent);
            opacity: 0.5;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 8px 24px var(--shadow-color),
                0 12px 40px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .stat-card:hover {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.12) inset,
                0 8px 24px var(--shadow-color),
                0 12px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: -0.08px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: #007AFF;
            color: white;
        }

        .stat-card.success .stat-icon {
            background: #34C759;
        }

        .stat-card.danger .stat-icon {
            background: #FF3B30;
        }

        .stat-card.warning .stat-icon {
            background: #FF9500;
        }

        .stat-card.info .stat-icon {
            background: #5AC8FA;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -1px;
        }

        .stat-card.danger .stat-icon {
            background: linear-gradient(135deg, var(--danger-color) 0%, #d63649 100%);
        }

        .stat-card.warning .stat-icon {
            background: linear-gradient(135deg, var(--warning-color) 0%, #e04f2c 100%);
        }

        .stat-card.info .stat-icon {
            background: #5AC8FA;
        }

        /* Card Section */
        .card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 1px 3px var(--shadow-color),
                0 4px 12px rgba(0, 0, 0, 0.04);
            border: 0.5px solid var(--border-color);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .card {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.08) inset,
                0 1px 3px var(--shadow-color),
                0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent);
            opacity: 0.5;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.08);
        }

        .card-header[style*="cursor: pointer"] {
            transition: all 0.2s ease;
            user-select: none;
        }

        .card-header[style*="cursor: pointer"]:hover {
            opacity: 0.7;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 0.5px solid rgba(0, 0, 0, 0.12);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 1px 2px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .form-control {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.05) inset,
                0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .form-control:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 0 0 4px rgba(0, 122, 255, 0.15),
                0 2px 8px rgba(0, 122, 255, 0.1),
                0 4px 16px rgba(0, 122, 255, 0.05);
            background: rgba(255, 255, 255, 0.95);
        }

        body.dark-mode .form-control:focus {
            background: rgba(28, 28, 30, 0.95);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 0 0 4px rgba(0, 122, 255, 0.2),
                0 2px 8px rgba(0, 122, 255, 0.15);
        }

        .form-hint {
            display: block;
            margin-top: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .input-group {
            display: flex;
            gap: 12px;
        }

        .input-group .form-control {
            flex: 1;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
            border-radius: 12px 12px 0 0;
            pointer-events: none;
            opacity: 0.8;
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #007AFF;
            color: white;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 1px 3px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 122, 255, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            background: #0051D5;
            transform: translateY(-1px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.3) inset,
                0 4px 12px rgba(0, 122, 255, 0.3),
                0 8px 24px rgba(0, 122, 255, 0.2);
        }

        .btn-primary:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-success {
            background: #34C759;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #248A3D;
        }

        .btn-danger {
            background: #FF3B30;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #D70015;
        }

        .btn-warning {
            background: #FF9500;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #C93400;
        }

        .btn-info {
            background: #5AC8FA;
            color: white;
        }

        .btn-outline {
            background: var(--bg-card);
            color: #007AFF;
            border: 1px solid rgba(0, 122, 255, 0.3);
        }

        .btn-outline:hover:not(:disabled) {
            background: rgba(0, 122, 255, 0.05);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(52, 199, 89, 0.1);
            color: #34C759;
        }

        .badge-danger {
            background: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
        }

        .badge-warning {
            background: rgba(255, 149, 0, 0.1);
            color: #FF9500;
        }

        .badge-info {
            background: rgba(90, 200, 250, 0.1);
            color: #5AC8FA;
        }

        /* Feed List */
        .feed-list {
            list-style: none;
        }

        .feed-item {
            background: var(--bg-card);
            padding: 20px;
            margin-bottom: 12px;
            border-radius: 16px;
            border: 0.5px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .feed-item {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.05) inset,
                0 1px 3px rgba(0, 0, 0, 0.15);
        }

        .feed-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(0, 122, 255, 0.2) 50%,
                    transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feed-item:hover {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 8px 24px var(--shadow-color),
                0 12px 40px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .feed-item:hover::after {
            opacity: 1;
        }

        body.dark-mode .feed-item:hover {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 8px 24px var(--shadow-color),
                0 12px 40px rgba(0, 0, 0, 0.25);
        }

        .feed-item.error {
            background: rgba(255, 59, 48, 0.05);
            border-color: rgba(255, 59, 48, 0.2);
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .feed-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .feed-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .feed-info {
            font-size: 13px;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .feed-url {
            font-size: 12px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        /* Feed Details (collapsed by default) */
        .feed-details {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(0, 0, 0, 0.06);
        }

        .feed-details.show {
            display: block;
        }

        .article-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .article-item {
            padding: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .article-item:last-child {
            border-bottom: none;
        }

        .article-title {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .article-date {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .detail-actions {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0, 0, 0, 0.06);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-primary {
            background: rgba(94, 114, 228, 0.1);
            color: var(--primary-color);
        }

        .badge-success {
            background: rgba(45, 206, 137, 0.1);
            color: var(--success-color);
        }

        .badge-danger {
            background: rgba(245, 54, 92, 0.1);
            color: var(--danger-color);
        }

        .badge-warning {
            background: rgba(251, 99, 64, 0.1);
            color: var(--warning-color);
        }

        .badge-info {
            background: rgba(17, 205, 239, 0.1);
            color: var(--info-color);
        }

        /* Alert Messages */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            animation: slideDown 0.3s ease;
        }

        .alert.show {
            display: flex;
        }

        .alert-success {
            background: rgba(45, 206, 137, 0.1);
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }

        .alert-danger {
            background: rgba(245, 54, 92, 0.1);
            border-left: 4px solid var(--danger-color);
            color: var(--danger-color);
        }

        .alert-info {
            background: rgba(17, 205, 239, 0.1);
            border-left: 4px solid var(--info-color);
            color: var(--info-color);
        }

        .alert-warning {
            background: rgba(251, 99, 64, 0.1);
            border-left: 4px solid var(--warning-color);
            color: var(--warning-color);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--text-secondary);
            opacity: 0.3;
            transition: 0.3s;
            border-radius: 24px;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.3) inset,
                0 2px 6px rgba(0, 0, 0, 0.15),
                0 1px 2px rgba(0, 0, 0, 0.1);
        }

        input:checked+.toggle-slider {
            background-color: var(--success-color);
            opacity: 1;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 2px 8px rgba(52, 199, 89, 0.3);
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 8px 32px rgba(0, 0, 0, 0.15),
                0 24px 64px rgba(0, 0, 0, 0.12);
            border: 0.5px solid var(--border-color);
        }

        body.dark-mode .modal-content {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.1) inset,
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 24px 64px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--secondary-color);
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--secondary-color);
        }

        .loading:before {
            content: "";
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Filters */
        .filter-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .filter-tag {
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .filter-include {
            background: rgba(45, 206, 137, 0.1);
            color: var(--success-color);
        }

        .filter-exclude {
            background: rgba(245, 54, 92, 0.1);
            color: var(--danger-color);
        }

        .filter-remove {
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .filter-remove:hover {
            transform: scale(1.2);
        }

        /* Mobile Overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding-bottom: 80px;
                /* Space for bottom bar */
            }

            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                height: auto;
                transform: translateX(0);
                background: var(--bg-secondary);
                backdrop-filter: saturate(180%) blur(20px);
                -webkit-backdrop-filter: saturate(180%) blur(20px);
                border-top: 0.5px solid var(--border-color);
                z-index: 1000;
                padding: 0;
                box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.1);
                display: block;
                /* Ensure it's visible */
                transition: none;
                /* Remove slide transition */
            }

            .sidebar-brand,
            .dark-mode-toggle,
            .mobile-menu-toggle,
            .sidebar-overlay {
                display: none !important;
                /* Hide these on mobile, !important to be sure */
            }

            .sidebar-menu {
                display: flex;
                justify-content: space-around;
                padding: 8px 0;
                margin: 0;
            }

            .sidebar-menu li {
                flex: 1;
                margin-bottom: 0;
            }

            .sidebar-menu a {
                flex-direction: column;
                justify-content: center;
                align-items: center;
                height: 100%;
                padding: 8px 5px;
                font-size: 11px;
                gap: 4px;
                border-radius: 6px;
            }

            .sidebar-menu a i {
                margin-right: 0;
                font-size: 20px;
                width: auto;
            }

            .sidebar-menu a.active {
                background: rgba(0, 122, 255, 0.1);
                color: var(--primary-color);
                box-shadow: none;
            }

            .sidebar-menu a.active i {
                color: var(--primary-color);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .mobile-menu-btn {
                display: none;
            }

            .content-area {
                padding: 16px;
            }

            .top-header {
                padding: 0 16px;
            }

            .page-title {
                font-size: 24px;
            }

            .header-actions .primary {
                display: none;
            }

            #mobile-dark-mode-toggle {
                display: flex;
            }

            .card {
                padding: 20px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        .mobile-menu-toggle {
            display: none;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--secondary-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Logs Container - Terminal style */
        body:not(.dark-mode) #logsContainer {
            background: #1e1e1e !important;
            color: #d4d4d4 !important;
        }

        body.dark-mode #logsContainer {
            background: #0a0a0a !important;
            color: #d4d4d4 !important;
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 220px;
            background: var(--bg-card);
            border: 0.5px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1001;
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 2px 8px var(--shadow-color),
                0 8px 24px rgba(0, 0, 0, 0.08);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
        }

        body.dark-mode .dark-mode-toggle {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.08) inset,
                0 2px 8px var(--shadow-color),
                0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .dark-mode-toggle:hover {
            transform: translateY(-1px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 4px 16px var(--shadow-color),
                0 12px 32px rgba(0, 0, 0, 0.12);
        }

        body.dark-mode .dark-mode-toggle:hover {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.12) inset,
                0 4px 16px var(--shadow-color),
                0 12px 32px rgba(0, 0, 0, 0.4);
        }

        .dark-mode-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .dark-mode-label i {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Liquid Glass Animations */
        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-4px);
            }
        }

        /* Enhanced Glass Effects for Interactive Elements */
        .btn-success {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 1px 3px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(52, 199, 89, 0.2);
        }

        .btn-success:hover:not(:disabled) {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.3) inset,
                0 4px 12px rgba(52, 199, 89, 0.3),
                0 8px 24px rgba(52, 199, 89, 0.2);
        }

        .btn-danger {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.2) inset,
                0 1px 3px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(255, 59, 48, 0.2);
        }

        .btn-danger:hover:not(:disabled) {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.3) inset,
                0 4px 12px rgba(255, 59, 48, 0.3),
                0 8px 24px rgba(255, 59, 48, 0.2);
        }

        /* Modal Glass Effect */
        .modal {
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
        }

        /* Alert Glass Enhancement */
        .alert {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.15) inset,
                0 2px 8px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .alert {
            box-shadow:
                0 0 0 0.5px rgba(255, 255, 255, 0.08) inset,
                0 2px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <h2><i class="fas fa-rss"></i> telRSSRadar</h2>
            <small>Made by fishyo</small>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#dashboard" class="active" onclick="showTab('dashboard')"><i class="fas fa-tachometer-alt"></i>
                    ‰ª™Ë°®Áõò</a></li>
            <li><a href="#feeds" onclick="showTab('feeds')"><i class="fas fa-stream"></i> ËÆ¢ÈòÖÊ∫êÁÆ°ÁêÜ</a></li>
            <li><a href="#ai-settings" onclick="showTab('ai-settings')"><i class="fas fa-robot"></i> AI Êèê‰æõÂïÜËÆæÁΩÆ</a></li>
            <li><a href="#system" onclick="showTab('system')"><i class="fas fa-cog"></i> Á≥ªÁªüËÆæÁΩÆ</a></li>
            <li><a href="#stats" onclick="showTab('stats')"><i class="fas fa-chart-bar"></i> ‰ΩøÁî®ÁªüËÆ°</a></li>
            <li><a href="#logs" onclick="showTab('logs')"><i class="fas fa-terminal"></i> ËøêË°åÊó•Âøó</a></li>
        </ul>
    </div>

    <!-- Dark Mode Toggle -->
    <div class="dark-mode-toggle" onclick="toggleDarkMode()">
        <div class="dark-mode-label">
            <i class="fas fa-moon" id="darkModeIcon"></i>
            <span id="darkModeText">ÈªëÊöóÊ®°Âºè</span>
        </div>
        <div class="toggle-switch" style="width: 44px; height: 24px;">
            <input type="checkbox" id="darkModeToggle" style="display: none;">
            <span class="toggle-slider" style="width: 44px; height: 24px;"></span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Header -->
        <div class="top-header">
            <h1 class="page-title">‰ª™Ë°®Áõò</h1>
            <div class="header-actions">
                <button class="header-btn" id="mobile-dark-mode-toggle" onclick="toggleDarkMode()"><i
                        class="fas fa-moon"></i></button>
                <button class="header-btn primary" onclick="manualCheck()">
                    <i class="fas fa-sync-alt"></i> ÊâãÂä®Ê£ÄÊü•
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-label">ËÆ¢ÈòÖÊ∫ê</span>
                            <div class="stat-icon"><i class="fas fa-rss"></i></div>
                        </div>
                        <div class="stat-value" id="feedCount">-</div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-header">
                            <span class="stat-label">ÊñáÁ´†ÊÄªÊï∞</span>
                            <div class="stat-icon"><i class="fas fa-newspaper"></i></div>
                        </div>
                        <div class="stat-value" id="articleCount">-</div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-header">
                            <span class="stat-label">Ê£ÄÊü•Èó¥Èöî(ÂàÜÈíü)</span>
                            <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        </div>
                        <div class="stat-value" id="checkInterval">-</div>
                    </div>

                    <div class="stat-card info">
                        <div class="stat-header">
                            <span class="stat-label">‰øùÁïôÂ§©Êï∞</span>
                            <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        </div>
                        <div class="stat-value" id="retentionDays">-</div>
                    </div>

                    <div class="stat-card danger" id="aiDriverCard" style="display: none;">
                        <div class="stat-header">
                            <span class="stat-label">AI ÊÄªÁªìÈ©±Âä®</span>
                            <div class="stat-icon"><i class="fas fa-brain"></i></div>
                        </div>
                        <div class="stat-value" id="aiDriverName" style="font-size: 18px;">-</div>
                    </div>
                </div>

                <!-- Database Info Card -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-database"></i> Êï∞ÊçÆÂ∫ì‰ø°ÊÅØ</h3>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Êï∞ÊçÆÂ∫ìÂ§ßÂ∞è</label>
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);" id="dbSize">-
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‰∏äÊ¨°Êõ¥Êñ∞</label>
                            <div style="font-size: 24px; font-weight: 600; color: var(--success-color);"
                                id="lastModified">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feeds Tab -->
            <div id="feeds-tab" class="tab-content">
                <!-- Add Feed Form -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="cursor: pointer;" onclick="toggleAddFeedForm()">
                        <h3 class="card-title"><i class="fas fa-plus-circle"></i> Ê∑ªÂä†ËÆ¢ÈòÖÊ∫ê</h3>
                        <button class="btn btn-outline btn-sm" id="toggleAddFeedBtn">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>

                    <div id="addFeedForm" style="display: none;">
                        <div id="addMessage"></div>

                        <div class="form-group">
                            <label class="form-label">RSS ËÆ¢ÈòÖÈìæÊé•</label>
                            <div class="input-group">
                                <input type="url" class="form-control" id="feedUrl"
                                    placeholder="https://example.com/feed.xml">
                                <button class="btn btn-outline" onclick="previewFeed()">
                                    <i class="fas fa-eye"></i> È¢ÑËßà
                                </button>
                            </div>
                        </div>

                        <div id="previewResult"
                            style="display:none; margin-bottom: 20px; padding: 20px; background: var(--bg-card); border-radius: 8px; border-left: 4px solid var(--primary-color); border: 0.5px solid var(--border-color);">
                            <div style="font-weight: 600; margin-bottom: 10px; font-size: 16px;"><i
                                    class="fas fa-newspaper"></i> <span id="previewTitle">Ê†áÈ¢ò</span></div>
                            <div style="color: var(--secondary-color); font-size: 14px; margin-bottom: 10px;">ÊúÄÊñ∞ <span
                                    id="previewCount">0</span> ÁØáÊñáÁ´†Ôºö</div>
                            <ul id="previewArticles"
                                style="margin: 0; padding-left: 20px; max-height: 200px; overflow-y: auto;"></ul>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ÂàùÂßãÂåñÊñπÂºè</label>
                            <select class="form-control" id="initMode" onchange="updateInitModeHint()">
                                <option value="record">‰ªÖËÆ∞ÂΩïÔºå‰∏çÊé®ÈÄÅ</option>
                                <option value="push-3">Êé®ÈÄÅÊúÄÊñ∞ 3 ÁØá</option>
                                <option value="push-5" selected>Êé®ÈÄÅÊúÄÊñ∞ 5 ÁØá</option>
                                <option value="push-10">Êé®ÈÄÅÊúÄÊñ∞ 10 ÁØá</option>
                                <option value="push-20">Êé®ÈÄÅÊúÄÊñ∞ 20 ÁØá</option>
                            </select>
                            <span class="form-hint" id="initModeHint">üí° Êé®ÈÄÅÊ®°Âºè‰ºöÁ´ãÂç≥ÂèëÈÄÅÊúÄÊñ∞ÊñáÁ´†Âà∞ Telegram</span>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enableAI">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span style="font-size: 14px; font-weight: 500;">ÂêØÁî® AI ÊÄªÁªì</span>
                            </label>
                            <span class="form-hint">üí° ÂºÄÂêØÂêéÔºåËØ•ËÆ¢ÈòÖÊ∫êÁöÑÊõ¥Êñ∞Â∞Ü‰ºöËá™Âä®ÁîüÊàê AI ÊÄªÁªì</span>
                        </div>

                        <button class="btn btn-primary" onclick="addFeed()">
                            <i class="fas fa-plus"></i> Ê∑ªÂä†ËÆ¢ÈòÖ
                        </button>
                    </div>
                </div>

                <!-- Feed List -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-stream"></i> ËÆ¢ÈòÖÊ∫êÂàóË°®</h3>
                        <div class="card-actions">
                            <select class="form-control" id="feedSort" onchange="sortFeeds()" style="width: auto;">
                                <option value="id-desc">ID ‚Üì</option>
                                <option value="id-asc">ID ‚Üë</option>
                                <option value="title-asc">Ê†áÈ¢ò A-Z</option>
                                <option value="title-desc">Ê†áÈ¢ò Z-A</option>
                                <option value="articles-desc">ÊñáÁ´†Êï∞ ‚Üì</option>
                                <option value="articles-asc">ÊñáÁ´†Êï∞ ‚Üë</option>
                            </select>
                        </div>
                    </div>

                    <div id="feedsMessage"></div>

                    <!-- Batch Management -->
                    <div
                        style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 0.5px solid var(--border-color);">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <button class="btn btn-outline btn-sm" id="selectAllBtn" onclick="selectAllFeeds()">
                                <i class="fas fa-check-square"></i> ÂÖ®ÈÄâ
                            </button>
                            <button class="btn btn-outline btn-sm" id="selectErrorBtn" onclick="selectErrorFeeds()"
                                style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> ÈÄâÊã©ÈîôËØØÊ∫ê
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="checkErrorFeeds()">
                                <i class="fas fa-sync"></i> Ê£ÄÊü•ÈîôËØØÊ∫ê
                            </button>
                            <button class="btn btn-danger btn-sm" id="batchDeleteBtn" onclick="batchDeleteFeeds()"
                                disabled>
                                <i class="fas fa-trash"></i> ÊâπÈáèÂà†Èô§
                            </button>
                            <span style="margin-left: auto; color: var(--secondary-color); font-size: 13px;">
                                Â∑≤ÈÄâÊã©: <strong id="selectedCount">0</strong> ‰∏™
                            </span>
                        </div>
                    </div>

                    <!-- Import/Export -->
                    <div
                        style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 0.5px solid var(--border-color);">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <button class="btn btn-success btn-sm" onclick="exportFeeds('opml')">
                                <i class="fas fa-file-export"></i> ÂØºÂá∫ OPML
                            </button>
                            <button class="btn btn-success btn-sm" onclick="exportFeeds('json')">
                                <i class="fas fa-file-code"></i> ÂØºÂá∫ JSON
                            </button>
                            <input type="file" id="importFile" accept=".opml,.xml,.json" style="display: none;"
                                onchange="importFeeds()">
                            <button class="btn btn-info btn-sm" onclick="document.getElementById('importFile').click()">
                                <i class="fas fa-file-import"></i> ÂØºÂÖ•ËÆ¢ÈòÖ
                            </button>
                        </div>
                    </div>

                    <div id="feedsLoading" class="loading" style="display: none;">Âä†ËΩΩ‰∏≠...</div>
                    <ul id="feedsList" class="feed-list"></ul>
                </div>
            </div>

            <!-- AI Settings Tab -->
            <div id="ai-settings-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-robot"></i> AI ÊÄªÁªìËÆæÁΩÆ</h3>
                    </div>

                    <div id="aiMessage"></div>

                    <!-- Global Toggle -->
                    <div
                        style="background: linear-gradient(135deg, var(--primary-color) 0%, #825ee4 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 5px;">ü§ñ AI ÊÄªÁªìÂäüËÉΩ</h4>
                                <p style="font-size: 13px; opacity: 0.9; margin: 0;">Ëá™Âä®‰∏∫RSSÊñáÁ´†ÁîüÊàêÊô∫ËÉΩÊëòË¶Å</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="aiEnabled">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- AI Status Card -->
                    <div id="aiStatusCard" class="card"
                        style="background: var(--bg-card); margin-bottom: 25px; border: 0.5px solid var(--border-color);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <strong style="color: var(--text-primary);">ÈÖçÁΩÆÁä∂ÊÄÅ</strong>
                            <span class="badge badge-success" id="aiStatusBadge">Â∑≤ÈÖçÁΩÆ</span>
                        </div>
                        <div class="grid-2">
                            <div>
                                <div style="font-size: 12px; color: var(--secondary-color); margin-bottom: 5px;">ÂÖ®Â±ÄÁä∂ÊÄÅ
                                </div>
                                <div style="font-weight: 600;" id="aiGlobalStatus">‚úÖ Â∑≤ÂêØÁî®</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: var(--secondary-color); margin-bottom: 5px;">Êèê‰æõÂïÜ
                                </div>
                                <div style="font-weight: 600;" id="aiProviderStatus">-</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: var(--secondary-color); margin-bottom: 5px;">API Key
                                </div>
                                <div style="font-weight: 600;" id="aiKeyStatus">‚ùå Êú™ÈÖçÁΩÆ</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: var(--secondary-color); margin-bottom: 5px;">Â∑≤ÂêØÁî®Ê∫ê
                                </div>
                                <div style="font-weight: 600;" id="aiEnabledFeedsCount">0 ‰∏™</div>
                            </div>
                        </div>
                    </div>

                    <h4 style="margin: 25px 0 15px; color: var(--text-primary); font-size: 16px;">‚öôÔ∏è AI Êèê‰æõÂïÜÈÖçÁΩÆ</h4>

                    <div class="form-group">
                        <label class="form-label">AI Êèê‰æõÂïÜ</label>
                        <select class="form-control" id="aiProvider" onchange="onProviderChange()">
                            <option value="gemini">Google Gemini</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="qwen">ÈÄö‰πâÂçÉÈóÆ</option>
                        </select>
                        <span class="form-hint">‰∏çÂêåÊèê‰æõÂïÜÁöÑ API Key ÂçïÁã¨‰øùÂ≠òÔºåÂàáÊç¢Êó∂Êó†ÈúÄÈáçÊñ∞ËæìÂÖ•</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">API Key</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="aiApiKey" placeholder="ËæìÂÖ• API Key">
                            <button class="btn btn-outline btn-sm" onclick="toggleApiKeyVisibility()" id="toggleKeyBtn"
                                title="ÊòæÁ§∫/ÈöêËóè">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="clearApiKey()" title="Ê∏ÖÈô§ Key">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <span class="form-hint" id="aiKeyInfo">Êú™ÈÖçÁΩÆ API Key</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ê®°ÂûãÂêçÁß∞ (ÂèØÈÄâ)</label>
                        <input type="text" class="form-control" id="aiModel" placeholder="ÁïôÁ©∫‰ΩøÁî®ÈªòËÆ§Ê®°Âûã">
                        <span class="form-hint" id="aiModelHint">Gemini: gemini-2.0-flash-exp | DeepSeek: deepseek-chat
                            | ÂçÉÈóÆ: qwen-flash</span>
                        <span class="form-hint" style="color: var(--success-color); font-weight: 500;">
                            üí° Â∑≤‰øùÂ≠ò API Key Êó∂,ÂèØ‰ª•Áõ¥Êé•‰øÆÊîπÊ®°ÂûãÈÖçÁΩÆÂπ∂‰øùÂ≠ò,Êó†ÈúÄÈáçÊñ∞ËæìÂÖ•ÂØÜÈí•
                        </span>
                    </div>

                    <h4 style="margin: 25px 0 15px; color: var(--text-primary); font-size: 16px;">üéöÔ∏è ÊÄªÁªìÂèÇÊï∞</h4>

                    <div class="form-group">
                        <label class="form-label">ÊúÄÂ∞ëÊñáÁ´†Êï∞ÈáèÈòàÂÄº</label>
                        <input type="number" class="form-control" id="aiMinArticles" min="1" max="20" placeholder="3">
                        <span class="form-hint">ÂçïÊ¨°Êõ¥Êñ∞ÊñáÁ´†Êï∞Èáè‰Ωé‰∫éÊ≠§ÂÄºÊó∂ÔºåË∑≥Ëøá AI ÊÄªÁªìÁõ¥Êé•Êé®ÈÄÅÂéüÊñá (ÈªòËÆ§: 3 ÁØá)</span>
                    </div>

                    <h4 style="margin: 25px 0 15px; color: var(--text-primary); font-size: 16px;">üõ†Ô∏è Êìç‰Ωú</h4>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="saveAISettings()">
                            <i class="fas fa-save"></i> ‰øùÂ≠ò AI ËÆæÁΩÆ
                        </button>
                        <button class="btn btn-primary" onclick="testAIConnection()" id="testAIBtn">
                            <i class="fas fa-plug"></i> ÊµãËØïËøûÊé•
                        </button>
                    </div>

                    <div class="form-hint" style="margin-top: 15px; line-height: 1.8;">
                        üí° <strong>‰øÆÊîπÊ®°Âûã</strong>ÔºöAPI Key Â∑≤‰øùÂ≠òÊó∂,ÂèØ‰ª•Áõ¥Êé•‰øÆÊîπ„ÄåÊ®°ÂûãÂêçÁß∞„ÄçÂπ∂ÁÇπÂáª‰øùÂ≠ò,Á≥ªÁªü‰ºö‰øùÁïôÂéüÊúâÂØÜÈí•Âè™Êõ¥Êñ∞Ê®°ÂûãÈÖçÁΩÆ<br>
                        üí° <strong>Êõ¥Êç¢ÂØÜÈí•</strong>ÔºöÈúÄË¶ÅÊõ¥Êç¢ API Key Êó∂,ÂÖàÁÇπÂáª„ÄåüóëÔ∏è„ÄçÊ∏ÖÈô§,ËæìÂÖ•Êñ∞ÂØÜÈí•ÂêéÂÜç‰øùÂ≠ò
                    </div>
                </div>
            </div>

            <!-- System Settings Tab -->
            <div id="system-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-cog"></i> Á≥ªÁªüËÆæÁΩÆ</h3>
                    </div>

                    <div id="settingsMessage"></div>

                    <h4 style="margin: 25px 0 15px; color: var(--text-primary); font-size: 16px;">‚öôÔ∏è ËøêË°åÂèÇÊï∞</h4>

                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Ê£ÄÊü•Èó¥Èöî (ÂàÜÈíü)</label>
                            <input type="number" class="form-control" id="settingInterval" min="1" placeholder="5">
                        </div>

                        <div class="form-group">
                            <label class="form-label">‰øùÁïôÂ§©Êï∞</label>
                            <input type="number" class="form-control" id="settingRetentionDays" min="1"
                                placeholder="30">
                        </div>

                        <div class="form-group">
                            <label class="form-label">ÊØèÊ∫ê‰øùÁïôÊñáÁ´†Êï∞</label>
                            <input type="number" class="form-control" id="settingRetentionCount" min="1"
                                placeholder="100">
                        </div>
                    </div>

                    <h4 style="margin: 25px 0 15px; color: var(--text-primary); font-size: 16px;">üõ†Ô∏è Êìç‰Ωú</h4>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i> ‰øùÂ≠òËÆæÁΩÆ
                        </button>
                        <button class="btn btn-warning" onclick="cleanupByDays()">
                            <i class="fas fa-broom"></i> ÊåâÂ§©Êï∞Ê∏ÖÁêÜ
                        </button>
                        <button class="btn btn-warning" onclick="cleanupByCount()">
                            <i class="fas fa-broom"></i> ÊåâÊï∞ÈáèÊ∏ÖÁêÜ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="stats-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-bar"></i> AI ‰ΩøÁî®ÁªüËÆ°</h3>
                    </div>

                    <div id="aiStatsLoading" class="loading">Âä†ËΩΩ‰∏≠...</div>
                    <div id="aiStatsContainer" style="display:none;">
                        <h4 style="margin-bottom: 15px; color: var(--text-primary); font-weight: 600;">üìä Ê±áÊÄªÁªüËÆ° (ÊúÄËøë30Â§©)
                        </h4>
                        <div id="aiStatsSummary" style="margin-bottom: 30px;"></div>

                        <h4 style="margin-bottom: 15px; color: var(--text-primary); font-weight: 600;">üìù ÊúÄËøëË∞ÉÁî®ËÆ∞ÂΩï</h4>
                        <div id="aiStatsRecent"></div>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="logs-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-terminal"></i> ËøêË°åÊó•Âøó</h3>
                        <div class="card-actions">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                <span
                                    style="font-size: 14px; font-weight: 500; color: var(--text-primary);">ÊúÄÊñ∞Êó•ÂøóÁΩÆÈ°∂</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sortLogsToggle" onchange="toggleLogSort()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                <span style="font-size: 14px; font-weight: 500; color: var(--text-primary);">Ëá™Âä®Âà∑Êñ∞</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoRefreshLogs" onchange="toggleAutoRefresh()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <button class="btn btn-primary btn-sm" onclick="loadLogs()">
                                <i class="fas fa-sync-alt"></i> Âà∑Êñ∞
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="clearLogs()">
                                <i class="fas fa-trash"></i> Ê∏ÖÁ©∫Êó•Âøó
                            </button>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;" id="logFilterButtons">
                        <button class="btn btn-sm btn-primary" onclick="filterLogs('all')">
                            ÂÖ®ÈÉ®
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="filterLogs('info')">
                            <i class="fas fa-info-circle"></i> ‰ø°ÊÅØ
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="filterLogs('warn')">
                            <i class="fas fa-exclamation-triangle"></i> Ë≠¶Âëä
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="filterLogs('error')">
                            <i class="fas fa-times-circle"></i> ÈîôËØØ
                        </button>
                    </div>

                    <div id="logsContainer"
                        style="background: var(--bg-card); color: var(--text-primary); padding: 20px; border-radius: 12px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; max-height: 600px; overflow-y: auto; border: 0.5px solid var(--border-color);">
                        <div id="logsContent">Âä†ËΩΩ‰∏≠...</div>
                    </div>

                    <div style="margin-top: 15px; color: var(--secondary-color); font-size: 13px;">
                        <i class="fas fa-info-circle"></i> ÊòæÁ§∫ÊúÄËøë <strong id="logsCount">0</strong> Êù°Êó•Âøó
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="renameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÈáçÂëΩÂêçËÆ¢ÈòÖÊ∫ê</h3>
                <button class="modal-close" onclick="closeRenameModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Êñ∞ÂêçÁß∞</label>
                <input type="text" class="form-control" id="renameTitle">
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeRenameModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="submitRename()">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <div id="filterModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ê∑ªÂä†ËøáÊª§ËßÑÂàô</h3>
                <button class="modal-close" onclick="closeFilterModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">ËøáÊª§Á±ªÂûã</label>
                <select class="form-control" id="filterType">
                    <option value="include">ÂåÖÂê´ÂÖ≥ÈîÆËØç</option>
                    <option value="exclude">ÊéíÈô§ÂÖ≥ÈîÆËØç</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ÂÖ≥ÈîÆËØç</label>
                <input type="text" class="form-control" id="filterKeyword" placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØç">
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeFilterModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="submitFilter()">Ê∑ªÂä†</button>
            </div>
        </div>
    </div>

    <script>
        // ‰øùÁïôÂéüÊúâÁöÑÊâÄÊúâJavaScriptÂäüËÉΩ‰ª£Á†Å
        let currentRenameFeedId = null;
        let currentFilterFeedId = null;
        let feedStatsMap = new Map();
        let errorFeedIds = new Set();

        // Tab Navigation
        function showTab(tabName) {
            // Update sidebar active state
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');

            // Update page title
            const titles = {
                'dashboard': '‰ª™Ë°®Áõò',
                'feeds': 'ËÆ¢ÈòÖÊ∫êÁÆ°ÁêÜ',
                'ai-settings': 'AI ÊÄªÁªìËÆæÁΩÆ',
                'system': 'Á≥ªÁªüËÆæÁΩÆ',
                'stats': '‰ΩøÁî®ÁªüËÆ°',
                'logs': 'ËøêË°åÊó•Âøó'
            };
            document.querySelector('.page-title').textContent = titles[tabName];

            // Show/hide tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');

            // Save current tab to localStorage
            localStorage.setItem('currentTab', tabName);

            // Update URL hash without scrolling
            history.replaceState(null, null, '#' + tabName);
        }

        // Toggle add feed form
        function toggleAddFeedForm() {
            const form = document.getElementById('addFeedForm');
            const btn = document.getElementById('toggleAddFeedBtn');
            const icon = btn.querySelector('i');

            if (form.style.display === 'none') {
                form.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
            } else {
                form.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
            }
        }

        // Show Message
        function showMessage(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (!container) return;

            const alertTypes = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'info': 'alert-info',
                'warning': 'alert-warning'
            };

            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'info': 'fa-info-circle',
                'warning': 'fa-exclamation-triangle'
            };

            container.innerHTML = `
                <div class="alert ${alertTypes[type]} show">
                    <i class="fas ${icons[type]}"></i>
                    <span>${message}</span>
                </div>
            `;

            setTimeout(() => {
                const alert = container.querySelector('.alert');
                if (alert) {
                    alert.classList.remove('show');
                    setTimeout(() => container.innerHTML = '', 300);
                }
            }, 5000);
        }

        // Load Stats
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const result = await response.json();
                if (result.success) {
                    document.getElementById('feedCount').textContent = result.data.feedCount;
                    document.getElementById('articleCount').textContent = result.data.articleCount;
                    document.getElementById('checkInterval').textContent = result.data.checkInterval;
                    document.getElementById('retentionDays').textContent = result.data.retentionDays;
                    document.getElementById('settingInterval').value = result.data.checkInterval;
                    document.getElementById('settingRetentionDays').value = result.data.retentionDays;
                    document.getElementById('settingRetentionCount').value = result.data.retentionCount;

                    // Load AI driver info
                    loadAIDriverInfo();

                    // Update database info
                    if (result.data.database) {
                        if (result.data.database.sizeFormatted) {
                            document.getElementById('dbSize').textContent = result.data.database.sizeFormatted;
                        }
                        // ÊòæÁ§∫ÂΩìÂâçÊó∂Èó¥‰Ωú‰∏∫ÊúÄÂêéÊõ¥Êñ∞Êó∂Èó¥
                        const now = new Date();
                        const timeStr = now.toLocaleString('zh-CN', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: false
                        });
                        document.getElementById('lastModified').textContent = timeStr;
                    }

                    // Update feed stats map
                    if (result.data.feedStats) {
                        feedStatsMap.clear();
                        result.data.feedStats.forEach(stat => {
                            feedStatsMap.set(stat.feedId, stat.articleCount);
                        });
                    }
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Load AI Driver Info
        async function loadAIDriverInfo() {
            try {
                const response = await fetch('/api/ai-settings');
                const result = await response.json();

                if (result.success) {
                    const aiCard = document.getElementById('aiDriverCard');
                    const aiDriverName = document.getElementById('aiDriverName');

                    const providerNames = {
                        'gemini': 'üîÆ Gemini',
                        'deepseek': 'üß† DeepSeek',
                        'qwen': '‚òÅÔ∏è ÂçÉÈóÆ'
                    };

                    const hasApiKey = result.data.apiKey && result.data.apiKey !== '';
                    const isEnabled = result.data.enabled;

                    if (isEnabled && hasApiKey) {
                        const providerDisplay = providerNames[result.data.provider] || result.data.provider;
                        aiDriverName.textContent = providerDisplay;
                        if (result.data.model) {
                            aiDriverName.title = `Ê®°Âûã: ${result.data.model}`;
                        }
                        aiCard.style.display = 'block';
                    } else {
                        aiCard.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Failed to load AI driver info:', error);
                document.getElementById('aiDriverCard').style.display = 'none';
            }
        }

        // Load feeds
        async function loadFeeds() {
            try {
                document.getElementById('feedsLoading').style.display = 'block';
                const response = await fetch('/api/feeds');
                const result = await response.json();

                if (result.success) {
                    const feedsList = document.getElementById('feedsList');
                    feedsList.innerHTML = '';

                    for (const feed of result.data) {
                        const filters = await loadFilters(feed.id);
                        const feedItem = createFeedElement(feed, filters);
                        feedsList.appendChild(feedItem);
                    }
                }
                document.getElementById('feedsLoading').style.display = 'none';
            } catch (error) {
                console.error('Failed to load feeds:', error);
                document.getElementById('feedsLoading').textContent = 'Âä†ËΩΩÂ§±Ë¥•';
            }
        }

        // Load filters for a feed
        async function loadFilters(feedId) {
            try {
                const response = await fetch(`/api/feeds/${feedId}/filters`);
                const result = await response.json();
                return result.success ? result.data : [];
            } catch (error) {
                console.error('Failed to load filters:', error);
                return [];
            }
        }

        // Create feed element
        function createFeedElement(feed, filters) {
            const li = document.createElement('li');
            li.className = 'feed-item' + (feed.error_count > 0 ? ' error' : '');
            li.dataset.feedId = feed.id;
            li.dataset.hasError = feed.error_count > 0 ? 'true' : 'false';

            const articleCount = feedStatsMap.get(feed.id) || 0;

            let filtersHtml = '';
            if (filters.length > 0) {
                filtersHtml = '<div class="filter-list">';
                filters.forEach(filter => {
                    filtersHtml += `<span class="filter-item filter-${filter.type}">${filter.type === 'include' ? 'ÂåÖÂê´' : 'ÊéíÈô§'}: ${filter.keyword} <a href="#" onclick="deleteFilter(${filter.id}); return false;">√ó</a></span>`;
                });
                filtersHtml += '</div>';
            }

            li.innerHTML = `
                <div class="feed-header" onclick="toggleFeedDetails(${feed.id})">
                    <div class="feed-title" style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" class="feed-checkbox" data-feed-id="${feed.id}" 
                               onclick="event.stopPropagation(); updateSelectedCount();" 
                               style="width: 18px; height: 18px; cursor: pointer;">
                        <span>
                            #${feed.id} ${feed.title || 'Êú™ÂëΩÂêç'}
                            <span class="badge badge-info">${articleCount} ÁØáÊñáÁ´†</span>
                            ${feed.ai_summary_enabled ? '<span class="badge badge-success">ü§ñ AI</span>' : ''}
                        </span>
                    </div>
                    <div class="feed-actions" onclick="event.stopPropagation();">
                        <label class="toggle-switch" title="${feed.ai_summary_enabled ? 'Á¶ÅÁî® AI ÊÄªÁªì' : 'ÂêØÁî® AI ÊÄªÁªì'}" style="margin-right: 8px; align-self: center;">
                            <input type="checkbox" ${feed.ai_summary_enabled ? 'checked' : ''} 
                                   onchange="toggleAISummary(${feed.id}, this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                        <button class="btn btn-primary btn-small" onclick="openRenameModal(${feed.id}, '${(feed.title || '').replace(/'/g, "\\'")}')">ÈáçÂëΩÂêç</button>
                        <button class="btn btn-success btn-small" onclick="openFilterModal(${feed.id})">ËøáÊª§</button>
                        <button class="btn btn-danger btn-small" onclick="deleteFeed(${feed.id})">Âà†Èô§</button>
                    </div>
                </div>
                <div class="feed-info">ÈîôËØØÊ¨°Êï∞: ${feed.error_count} | ÊúÄÂêéÊ£ÄÊü•: ${feed.last_check ? new Date(feed.last_check * 1000).toLocaleString('zh-CN') : 'Êú™Ê£ÄÊü•'}</div>
                <div class="feed-url">${feed.url}</div>
                ${filtersHtml}
                <div class="feed-details" id="details-${feed.id}">
                    <div id="articles-${feed.id}" class="article-list">
                        <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                    </div>
                    <div class="detail-actions">
                        <button class="btn btn-danger btn-small" onclick="clearFeedArticles(${feed.id})">Ê∏ÖÁ©∫ËØ•Ê∫êÁöÑÊñáÁ´†</button>
                    </div>
                </div>
            `;

            return li;
        }

        // Toggle feed details
        async function toggleFeedDetails(feedId) {
            const detailsDiv = document.getElementById(`details-${feedId}`);
            const feedItem = document.querySelector(`[data-feed-id="${feedId}"]`);

            if (detailsDiv.classList.contains('show')) {
                detailsDiv.classList.remove('show');
                feedItem.classList.remove('expanded');
            } else {
                detailsDiv.classList.add('show');
                feedItem.classList.add('expanded');
                await loadFeedArticles(feedId);
            }
        }

        // Load articles for a feed
        async function loadFeedArticles(feedId) {
            try {
                const articlesDiv = document.getElementById(`articles-${feedId}`);
                articlesDiv.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏≠...</div>';

                const response = await fetch(`/api/feeds/${feedId}/articles?limit=50`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    if (result.data.length === 0) {
                        articlesDiv.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">ÊöÇÊó†ÊñáÁ´†</div>';
                    } else {
                        articlesDiv.innerHTML = result.data.map(article => `
                            <div class="article-item">
                                <div class="article-title">${article.title || 'Êó†Ê†áÈ¢ò'}</div>
                                <div class="article-date">${new Date(article.published_at * 1000).toLocaleString('zh-CN')}</div>
                            </div>
                        `).join('');
                    }
                } else {
                    articlesDiv.innerHTML = `<div class="loading">Âä†ËΩΩÂ§±Ë¥•: ${result.error}</div>`;
                }
            } catch (error) {
                console.error('Failed to load articles:', error);
                const articlesDiv = document.getElementById(`articles-${feedId}`);
                if (articlesDiv) {
                    articlesDiv.innerHTML = `<div class="loading">Âä†ËΩΩÂ§±Ë¥•: ${error.message}</div>`;
                }
            }
        }

        // Clear feed articles
        async function clearFeedArticles(feedId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ËØ•ËÆ¢ÈòÖÊ∫êÁöÑÊâÄÊúâÊñáÁ´†ÂêóÔºü')) return;

            try {
                const response = await fetch(`/api/feeds/${feedId}/articles`, { method: 'DELETE' });
                const result = await response.json();

                if (result.success) {
                    alert(`Â∑≤Ê∏ÖÁêÜ ${result.deletedCount} ÁØáÊñáÁ´†`);
                    await loadFeedArticles(feedId);
                    loadStats();
                } else {
                    alert('Ê∏ÖÁêÜÂ§±Ë¥•: ' + result.error);
                }
            } catch (error) {
                alert('Ê∏ÖÁêÜÂ§±Ë¥•: ' + error.message);
            }
        }

        // Toggle section
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + 'Content');
            const btn = event.target;

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                btn.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                btn.classList.add('collapsed');
            }
        }

        // Sort feeds
        function sortFeeds() {
            const sortValue = document.getElementById('feedSort').value;
            const feedsList = document.getElementById('feedsList');
            const items = Array.from(feedsList.children);

            items.sort((a, b) => {
                const [field, order] = sortValue.split('-');
                let aVal, bVal;

                if (field === 'id') {
                    aVal = parseInt(a.dataset.feedId);
                    bVal = parseInt(b.dataset.feedId);
                } else if (field === 'title') {
                    aVal = a.querySelector('.feed-title').textContent.toLowerCase();
                    bVal = b.querySelector('.feed-title').textContent.toLowerCase();
                } else if (field === 'articles') {
                    const aBadge = a.querySelector('.badge-info');
                    const bBadge = b.querySelector('.badge-info');
                    aVal = aBadge ? parseInt(aBadge.textContent) : 0;
                    bVal = bBadge ? parseInt(bBadge.textContent) : 0;
                }

                if (order === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            feedsList.innerHTML = '';
            items.forEach(item => feedsList.appendChild(item));
        }

        // Preview feed
        async function previewFeed() {
            const url = document.getElementById('feedUrl').value.trim();
            if (!url) {
                showMessage('addMessage', 'ËØ∑ËæìÂÖ• RSS ÈìæÊé•', 'error');
                return;
            }

            const previewResult = document.getElementById('previewResult');
            previewResult.style.display = 'none';
            showMessage('addMessage', 'üîç Ê≠£Âú®Âä†ËΩΩÈ¢ÑËßà...', 'info');

            try {
                const response = await fetch('/api/feeds/preview', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                if (!response.ok) {
                    const result = await response.json();
                    showMessage('addMessage', '‚ùå ' + (result.error || 'È¢ÑËßàÂ§±Ë¥•'), 'error');
                    return;
                }

                const result = await response.json();

                if (result.success) {
                    document.getElementById('previewTitle').textContent = result.data.title;
                    document.getElementById('previewCount').textContent = result.data.articles.length;

                    const articlesList = document.getElementById('previewArticles');
                    articlesList.innerHTML = result.data.articles.map(article =>
                        `<li style="margin-bottom:5px;"><a href="${article.link}" target="_blank" style="color:#667eea;text-decoration:none;">${article.title}</a></li>`
                    ).join('');

                    previewResult.style.display = 'block';
                    showMessage('addMessage', '‚úÖ È¢ÑËßàÂä†ËΩΩÊàêÂäü', 'success');
                } else {
                    showMessage('addMessage', '‚ùå ' + result.error, 'error');
                }
            } catch (error) {
                console.error('È¢ÑËßàÈîôËØØ:', error);
                let errorMsg = 'È¢ÑËßàÂ§±Ë¥•';

                if (error.message === 'Failed to fetch') {
                    errorMsg = 'Êó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®ÔºåËØ∑Á°Æ‰øùÊúçÂä°Ê≠£Âú®ËøêË°å (http://localhost:3000)';
                } else if (error.name === 'TypeError') {
                    errorMsg = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•';
                } else {
                    errorMsg += ': ' + error.message;
                }

                showMessage('addMessage', '‚ùå ' + errorMsg, 'error');
            }
        }

        // Update init mode hint
        function updateInitModeHint() {
            const initMode = document.getElementById('initMode').value;
            const hint = document.getElementById('initModeHint');

            if (initMode === 'record') {
                hint.textContent = 'üíæ ‰ªÖËÆ∞ÂΩïÊñáÁ´†Âà∞Êï∞ÊçÆÂ∫ìÔºå‰∏ç‰ºöÊé®ÈÄÅÂà∞ Telegram';
            } else {
                const count = initMode.split('-')[1];
                hint.textContent = `üí° Êé®ÈÄÅÊ®°Âºè‰ºöÁ´ãÂç≥ÂèëÈÄÅÊúÄÊñ∞ ${count} ÁØáÊñáÁ´†Âà∞ Telegram`;
            }
        }

        // Add feed
        async function addFeed() {
            const url = document.getElementById('feedUrl').value.trim();
            if (!url) {
                showMessage('addMessage', 'ËØ∑ËæìÂÖ• RSS ÈìæÊé•', 'error');
                return;
            }

            const initMode = document.getElementById('initMode').value;
            const pushLatest = initMode !== 'record';
            const pushCount = pushLatest ? parseInt(initMode.split('-')[1]) : 0;
            const enableAI = document.getElementById('enableAI').checked;

            try {
                const response = await fetch('/api/feeds', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, pushLatest, pushCount, enableAI })
                });
                const result = await response.json();

                if (result.success) {
                    const message = result.data.pushed
                        ? `‚úÖ Ê∑ªÂä†ÊàêÂäü: ${result.data.title} (Â∑≤Êé®ÈÄÅ ${result.data.articleCount} ÁØáÊúÄÊñ∞ÊñáÁ´†)`
                        : `‚úÖ Ê∑ªÂä†ÊàêÂäü: ${result.data.title} (Â∑≤ËÆ∞ÂΩï ${result.data.articleCount} ÁØáÊñáÁ´†)`;
                    showMessage('addMessage', message, 'success');
                    document.getElementById('feedUrl').value = '';
                    document.getElementById('initMode').value = 'push-5';
                    document.getElementById('enableAI').checked = false;
                    document.getElementById('previewResult').style.display = 'none';
                    updateInitModeHint();
                    loadFeeds();
                    loadStats();
                } else {
                    showMessage('addMessage', '‚ùå ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('addMessage', '‚ùå Ê∑ªÂä†Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Delete feed
        async function deleteFeed(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÆ¢ÈòÖÊ∫êÂêó?')) return;

            try {
                const response = await fetch(`/api/feeds/${id}`, { method: 'DELETE' });
                const result = await response.json();

                if (result.success) {
                    loadFeeds();
                    loadStats();
                } else {
                    alert('Âà†Èô§Â§±Ë¥•: ' + result.error);
                }
            } catch (error) {
                alert('Âà†Èô§Â§±Ë¥•: ' + error.message);
            }
        }

        // Rename modal
        function openRenameModal(id, title) {
            currentRenameFeedId = id;
            document.getElementById('renameTitle').value = title;
            document.getElementById('renameModal').classList.add('active');
        }

        function closeRenameModal() {
            document.getElementById('renameModal').classList.remove('active');
        }

        async function submitRename() {
            const title = document.getElementById('renameTitle').value.trim();
            if (!title) return;

            try {
                const response = await fetch(`/api/feeds/${currentRenameFeedId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title })
                });
                const result = await response.json();

                if (result.success) {
                    closeRenameModal();
                    loadFeeds();
                } else {
                    alert('ÈáçÂëΩÂêçÂ§±Ë¥•: ' + result.error);
                }
            } catch (error) {
                alert('ÈáçÂëΩÂêçÂ§±Ë¥•: ' + error.message);
            }
        }

        // Filter modal
        function openFilterModal(id) {
            currentFilterFeedId = id;
            document.getElementById('filterKeyword').value = '';
            document.getElementById('filterModal').classList.add('active');
        }

        function closeFilterModal() {
            document.getElementById('filterModal').classList.remove('active');
        }

        async function submitFilter() {
            const type = document.getElementById('filterType').value;
            const keyword = document.getElementById('filterKeyword').value.trim();

            if (!keyword) return;

            try {
                const response = await fetch('/api/filters', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ feedId: currentFilterFeedId, type, keyword })
                });
                const result = await response.json();

                if (result.success) {
                    closeFilterModal();
                    loadFeeds();
                } else {
                    alert('Ê∑ªÂä†ËøáÊª§ËßÑÂàôÂ§±Ë¥•: ' + result.error);
                }
            } catch (error) {
                alert('Ê∑ªÂä†ËøáÊª§ËßÑÂàôÂ§±Ë¥•: ' + error.message);
            }
        }

        // Delete filter
        async function deleteFilter(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËøáÊª§ËßÑÂàôÂêó?')) return;

            try {
                const response = await fetch(`/api/filters/${id}`, { method: 'DELETE' });
                const result = await response.json();

                if (result.success) {
                    loadFeeds();
                }
            } catch (error) {
                alert('Âà†Èô§Â§±Ë¥•: ' + error.message);
            }
        }

        // Save settings
        async function saveSettings() {
            const checkInterval = parseInt(document.getElementById('settingInterval').value);
            const retentionDays = parseInt(document.getElementById('settingRetentionDays').value);
            const retentionCount = parseInt(document.getElementById('settingRetentionCount').value);

            try {
                const response = await fetch('/api/settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ checkInterval, retentionDays, retentionCount })
                });
                const result = await response.json();

                if (result.success) {
                    showMessage('settingsMessage', '‚úÖ ËÆæÁΩÆÂ∑≤‰øùÂ≠ò (ÈúÄË¶ÅÈáçÂêØÊúçÂä°ÁîüÊïà)', 'success');
                    loadStats();
                } else {
                    showMessage('settingsMessage', '‚ùå ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('settingsMessage', '‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Manual check
        async function manualCheck() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊâãÂä®Ê£ÄÊü•ÊâÄÊúâËÆ¢ÈòÖÊ∫êÊõ¥Êñ∞Âêó?')) return;

            showMessage('settingsMessage', '‚è≥ Ê£ÄÊü•‰∏≠...', 'success');
            try {
                const response = await fetch('/api/check', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    showMessage('settingsMessage', `‚úÖ Ê£ÄÊü•ÂÆåÊàê: ${result.data.successCount} ÊàêÂäü, ${result.data.failCount} Â§±Ë¥•`, 'success');
                    loadFeeds();
                    loadStats();
                }
            } catch (error) {
                showMessage('settingsMessage', '‚ùå Ê£ÄÊü•Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Cleanup by days
        async function cleanupByDays() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁêÜÊóßÊñáÁ´†Âêó? (ÊåâÂ§©Êï∞)')) return;

            try {
                const response = await fetch('/api/cleanup/days', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    showMessage('settingsMessage', `‚úÖ Â∑≤Ê∏ÖÁêÜ ${result.deletedCount} ÁØáÊñáÁ´†`, 'success');
                    loadStats();
                }
            } catch (error) {
                showMessage('settingsMessage', '‚ùå Ê∏ÖÁêÜÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Cleanup by count
        async function cleanupByCount() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁêÜÊóßÊñáÁ´†Âêó? (ÊåâÊï∞Èáè)')) return;

            try {
                const response = await fetch('/api/cleanup/count', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    showMessage('settingsMessage', `‚úÖ Â∑≤Ê∏ÖÁêÜ ${result.deletedCount} ÁØáÊñáÁ´†`, 'success');
                    loadStats();
                }
            } catch (error) {
                showMessage('settingsMessage', '‚ùå Ê∏ÖÁêÜÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Show message
        function showMessage(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`[showMessage] ÂÆπÂô®‰∏çÂ≠òÂú®: ${containerId}`);
                return;
            }

            container.innerHTML = '';

            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.style.cssText = 'display: block; opacity: 0; transition: opacity 0.3s ease-in-out;';
            messageDiv.textContent = message;

            container.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.style.opacity = '1';
            }, 10);

            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    if (container.contains(messageDiv)) {
                        container.removeChild(messageDiv);
                    }
                }, 300);
            }, 5000);
        }

        // Toggle AI summary for feed
        async function toggleAISummary(feedId, enabled) {
            try {
                const response = await fetch(`/api/feeds/${feedId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ aiSummaryEnabled: enabled })
                });
                const result = await response.json();

                if (result.success) {
                    loadFeeds();
                    loadAISettings();
                } else {
                    alert('ËÆæÁΩÆÂ§±Ë¥•: ' + result.error);
                    event.target.checked = !enabled;
                }
            } catch (error) {
                alert('ËÆæÁΩÆÂ§±Ë¥•: ' + error.message);
                event.target.checked = !enabled;
            }
        }

        // Load AI settings
        async function loadAISettings() {
            try {
                const response = await fetch('/api/ai-settings');
                const result = await response.json();
                if (result.success) {
                    document.getElementById('aiEnabled').checked = result.data.enabled;
                    document.getElementById('aiProvider').value = result.data.provider;
                    if (result.data.apiKey && !result.data.apiKey.startsWith('***')) {
                        document.getElementById('aiApiKey').value = result.data.apiKey;
                    }
                    document.getElementById('aiModel').value = result.data.model || '';
                    document.getElementById('aiMinArticles').value = result.data.minArticles || 3;

                    updateAIStatusCard(result.data);
                    updateApiKeyInfo(result.data.apiKey, result.data.provider);
                }
            } catch (error) {
                console.error('Failed to load AI settings:', error);
            }
        }

        // Update API Key info display
        function updateApiKeyInfo(apiKey, provider) {
            const keyInfo = document.getElementById('aiKeyInfo');
            if (apiKey && apiKey.startsWith('***')) {
                const lastFour = apiKey.slice(-4);
                keyInfo.textContent = `Â∑≤ÈÖçÁΩÆ (****${lastFour})`;
                keyInfo.style.color = '#10b981';
            } else if (apiKey) {
                keyInfo.textContent = `Â∑≤ËæìÂÖ• (Êú™‰øùÂ≠ò)`;
                keyInfo.style.color = '#f59e0b';
            } else {
                keyInfo.textContent = 'Êú™ÈÖçÁΩÆ API Key';
                keyInfo.style.color = '#ef4444';
            }
        }

        // Toggle API Key visibility
        function toggleApiKeyVisibility() {
            const input = document.getElementById('aiApiKey');
            const btn = document.getElementById('toggleKeyBtn');
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
                btn.title = 'ÈöêËóè';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅÔ∏è';
                btn.title = 'ÊòæÁ§∫';
            }
        }

        // Clear API Key
        async function clearApiKey() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÂΩìÂâçÊèê‰æõÂïÜÁöÑ API Key ÂêóÔºüÊ∏ÖÈô§ÂêéÈúÄË¶ÅÈáçÊñ∞ËæìÂÖ•„ÄÇ')) {
                return;
            }

            const provider = document.getElementById('aiProvider').value;

            try {
                const response = await fetch(`/api/ai-settings/apikey/${provider}`, {
                    method: 'DELETE'
                });
                const result = await response.json();

                if (result.success) {
                    // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
                    document.getElementById('aiApiKey').value = '';
                    updateApiKeyInfo('', provider);
                    showMessage('aiMessage', `‚úÖ ${provider} ÁöÑ API Key Â∑≤Âà†Èô§`, 'success');
                } else {
                    showMessage('aiMessage', '‚ùå Âà†Èô§Â§±Ë¥•: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Failed to delete API key:', error);
                showMessage('aiMessage', '‚ùå Âà†Èô§Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Provider change handler
        async function onProviderChange() {
            const provider = document.getElementById('aiProvider').value;
            const helpDiv = document.getElementById('apiKeyHelp');
            const helpContent = document.getElementById('helpContent');

            try {
                await fetch('/api/ai-settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider })
                });
                await loadAISettings();
            } catch (error) {
                console.error('Failed to update provider:', error);
            }

            const helpTexts = {
                'gemini': `
                    <p><strong>Google Gemini API Key Ëé∑ÂèñÊ≠•È™§:</strong></p>
                    <ol style="margin:10px 0;padding-left:20px;">
                        <li>ËÆøÈóÆ <a href="https://aistudio.google.com/apikey" target="_blank" style="color:#007AFF;">Google AI Studio</a></li>
                        <li>‰ΩøÁî® Google Ë¥¶Âè∑ÁôªÂΩï</li>
                        <li>ÁÇπÂáª "Create API Key" ÊåâÈíÆ</li>
                        <li>Â§çÂà∂ÁîüÊàêÁöÑ API Key Âπ∂Á≤òË¥¥Âà∞‰∏äÊñπËæìÂÖ•Ê°Ü</li>
                    </ol>
                `,
                'deepseek': `
                    <p><strong>DeepSeek API Key Ëé∑ÂèñÊ≠•È™§:</strong></p>
                    <ol style="margin:10px 0;padding-left:20px;">
                        <li>ËÆøÈóÆ <a href="https://platform.deepseek.com" target="_blank" style="color:#007AFF;">DeepSeek Âπ≥Âè∞</a></li>
                        <li>Ê≥®ÂÜåÂπ∂ÁôªÂΩïË¥¶Âè∑</li>
                        <li>ËøõÂÖ• API Keys È°µÈù¢</li>
                        <li>ÂàõÂª∫Êñ∞ÁöÑ API Key</li>
                        <li>Â§çÂà∂ Key Âπ∂Á≤òË¥¥Âà∞‰∏äÊñπËæìÂÖ•Ê°Ü</li>
                    </ol>
                `,
                'qwen': `
                    <p><strong>ÈÄö‰πâÂçÉÈóÆ API Key Ëé∑ÂèñÊ≠•È™§:</strong></p>
                    <ol style="margin:10px 0;padding-left:20px;">
                        <li>ËÆøÈóÆ <a href="https://dashscope.aliyun.com" target="_blank" style="color:#007AFF;">ÈòøÈáå‰∫ë DashScope</a></li>
                        <li>‰ΩøÁî®ÈòøÈáå‰∫ëË¥¶Âè∑ÁôªÂΩï</li>
                        <li>ËøõÂÖ• API-KEY ÁÆ°ÁêÜÈ°µÈù¢</li>
                        <li>ÂàõÂª∫Êñ∞ÁöÑ API Key</li>
                        <li>Â§çÂà∂ Key Âπ∂Á≤òË¥¥Âà∞‰∏äÊñπËæìÂÖ•Ê°Ü</li>
                    </ol>
                `
            };

            helpContent.innerHTML = helpTexts[provider] || '';
            helpDiv.style.display = 'block';

            const modelHints = {
                'gemini': 'Gemini: gemini-2.0-flash-exp (Êé®Ëçê) | gemini-pro',
                'deepseek': 'DeepSeek: deepseek-chat (Êé®Ëçê)',
                'qwen': 'ÂçÉÈóÆ: qwen-turbo (Êé®Ëçê) | qwen-plus | qwen-max'
            };
            document.getElementById('aiModelHint').textContent = modelHints[provider] || '';
        }

        // Test AI connection
        async function testAIConnection() {
            const provider = document.getElementById('aiProvider').value;
            const apiKey = document.getElementById('aiApiKey').value.trim();
            const model = document.getElementById('aiModel').value.trim();
            const isMasked = apiKey.startsWith('***');

            if (!apiKey) {
                showMessage('aiMessage', '‚ö†Ô∏è ËØ∑ÂÖàËæìÂÖ• API Key ÊàñÈÖçÁΩÆÂ∑≤‰øùÂ≠òÁöÑÂØÜÈí•', 'error');
                return;
            }

            const testBtn = document.getElementById('testAIBtn');
            if (testBtn) {
                testBtn.disabled = true;
                testBtn.textContent = '‚è≥ ÊµãËØï‰∏≠...';
            }

            try {
                const progressMsg = isMasked
                    ? 'üîÑ Ê≠£Âú®‰ΩøÁî®Â∑≤‰øùÂ≠òÁöÑ API Key ÊµãËØïËøûÊé•...'
                    : 'üîÑ Ê≠£Âú®‰øùÂ≠òÊñ∞ÁöÑ API Key Âπ∂ÊµãËØïËøûÊé•...';
                showMessage('aiMessage', progressMsg, 'info');

                const requestBody = { enabled: true, provider };
                if (model) requestBody.model = model;
                if (!isMasked && apiKey) requestBody.apiKey = apiKey;

                const response = await fetch('/api/ai-settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const result = await response.json();

                if (result.success) {
                    const providerNames = {
                        'gemini': 'Google Gemini',
                        'deepseek': 'DeepSeek',
                        'qwen': 'ÈÄö‰πâÂçÉÈóÆ'
                    };
                    const modelInfo = model ? ` (Ê®°Âûã: ${model})` : '';
                    const keyStatus = isMasked ? '‰ΩøÁî®Â∑≤‰øùÂ≠òÁöÑ API Key' : 'API Key Â∑≤‰øùÂ≠ò';
                    const successMsg = `‚úÖ ÈÖçÁΩÆÊàêÂäüÔºÅ${providerNames[provider]} ${keyStatus}${modelInfo}ÔºåÂ∞ÜÂú®‰∏ãÊ¨° RSS Ê£ÄÊü•Êó∂ËøõË°åÂÆûÈôÖË∞ÉÁî®`;

                    showMessage('aiMessage', successMsg, 'success');
                    await loadAISettings();
                } else {
                    showMessage('aiMessage', '‚ùå ÊµãËØïÂ§±Ë¥•: ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('aiMessage', '‚ùå Êìç‰ΩúÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                if (testBtn) {
                    testBtn.disabled = false;
                    testBtn.textContent = 'üîå ÊµãËØïËøûÊé•';
                }
            }
        }

        // Update AI status card
        async function updateAIStatusCard(aiSettings) {
            let enabledFeedsCount = 0;
            try {
                const feedsResponse = await fetch('/api/feeds');
                const feedsResult = await feedsResponse.json();
                if (feedsResult.success) {
                    enabledFeedsCount = feedsResult.data.filter(f => f.ai_summary_enabled === 1).length;
                }
            } catch (error) {
                console.error('Failed to count enabled feeds:', error);
            }

            const hasApiKey = aiSettings.apiKey && aiSettings.apiKey !== '';
            const isGlobalEnabled = aiSettings.enabled;

            document.getElementById('aiGlobalStatus').textContent = isGlobalEnabled ? '‚úÖ Â∑≤ÂêØÁî®' : '‚ùå Â∑≤Á¶ÅÁî®';

            const providerNames = {
                'gemini': 'Google Gemini',
                'deepseek': 'DeepSeek',
                'qwen': 'ÈÄö‰πâÂçÉÈóÆ'
            };
            document.getElementById('aiProviderStatus').textContent = providerNames[aiSettings.provider] || aiSettings.provider;

            document.getElementById('aiKeyStatus').textContent = hasApiKey ? '‚úÖ Â∑≤ÈÖçÁΩÆ' : '‚ùå Êú™ÈÖçÁΩÆ';

            document.getElementById('aiEnabledFeedsCount').textContent = `${enabledFeedsCount} ‰∏™`;

            const statusBadge = document.getElementById('aiStatusBadge');
            if (isGlobalEnabled && hasApiKey && enabledFeedsCount > 0) {
                statusBadge.textContent = '‚úÖ Â∑≤ÈÖçÁΩÆ';
                statusBadge.className = 'status-badge status-configured';
            } else if (hasApiKey && (isGlobalEnabled || enabledFeedsCount > 0)) {
                statusBadge.textContent = '‚ö†Ô∏è ÈÉ®ÂàÜÈÖçÁΩÆ';
                statusBadge.className = 'status-badge status-partial';
            } else {
                statusBadge.textContent = '‚ùå Êú™ÈÖçÁΩÆ';
                statusBadge.className = 'status-badge status-unconfigured';
            }
        }

        // Save AI settings
        async function saveAISettings() {
            const enabled = document.getElementById('aiEnabled').checked;
            const provider = document.getElementById('aiProvider').value;
            const apiKey = document.getElementById('aiApiKey').value.trim();
            const model = document.getElementById('aiModel').value.trim();
            const minArticles = parseInt(document.getElementById('aiMinArticles').value) || 3;
            const isMasked = apiKey.startsWith('***');

            const saveBtn = document.querySelector('button[onclick="saveAISettings()"]');
            if (saveBtn) {
                saveBtn.disabled = true;
                saveBtn.textContent = 'üíæ ‰øùÂ≠ò‰∏≠...';
            }

            try {
                const requestBody = { enabled, provider, model, minArticles };

                if (!isMasked && apiKey) {
                    requestBody.apiKey = apiKey;
                }

                const response = await fetch('/api/ai-settings', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const result = await response.json();

                if (result.success) {
                    const providerNames = {
                        'gemini': 'Google Gemini',
                        'deepseek': 'DeepSeek',
                        'qwen': 'ÈÄö‰πâÂçÉÈóÆ'
                    };
                    const keyInfo = (!isMasked && apiKey) ? 'ÔºåAPI Key Â∑≤Êõ¥Êñ∞' : '';
                    const modelInfo = model ? `ÔºåÊ®°Âûã: ${model}` : 'Ôºå‰ΩøÁî®ÈªòËÆ§Ê®°Âûã';
                    const successMsg = `‚úÖ AI ËÆæÁΩÆÂ∑≤ÊàêÂäü‰øùÂ≠òÔºÅÊèê‰æõÂïÜ: ${providerNames[provider]}${modelInfo}${keyInfo}`;

                    showMessage('aiMessage', successMsg, 'success');

                    await loadAISettings();
                    await loadAIStats();
                } else {
                    showMessage('aiMessage', '‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('aiMessage', '‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'üíæ ‰øùÂ≠ò AI ËÆæÁΩÆ';
                }
            }
        }

        // Load AI stats
        async function loadAIStats() {
            try {
                document.getElementById('aiStatsLoading').style.display = 'block';
                document.getElementById('aiStatsContainer').style.display = 'none';

                const response = await fetch('/api/ai-stats?days=30');
                const result = await response.json();

                if (result.success) {
                    const { summary, recentCalls } = result.data;

                    let summaryHtml = '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">';

                    if (summary.length === 0) {
                        summaryHtml = '<p style="text-align:center;color:#999;">ÊöÇÊó†‰ΩøÁî®ËÆ∞ÂΩï</p>';
                    } else {
                        summary.forEach(stat => {
                            const currency = stat.provider === 'gemini' ? 'USD' : 'CNY';
                            summaryHtml += `
                                <div style="background:var(--bg-card);padding:15px;border-radius:8px;border:1px solid var(--border-color);">
                                    <div style="font-weight:600;color:var(--text-primary);margin-bottom:10px;">${stat.provider.toUpperCase()}</div>
                                    <div style="font-size:13px;color:var(--text-secondary);margin-bottom:5px;">Ë∞ÉÁî®Ê¨°Êï∞: ${stat.call_count}</div>
                                    <div style="font-size:13px;color:var(--text-secondary);margin-bottom:5px;">ËæìÂÖ• Token: ${stat.total_input_tokens.toLocaleString()}</div>
                                    <div style="font-size:13px;color:var(--text-secondary);margin-bottom:5px;">ËæìÂá∫ Token: ${stat.total_output_tokens.toLocaleString()}</div>
                                    <div style="font-size:13px;color:var(--text-secondary);margin-bottom:5px;">ÊÄª Token: ${stat.total_tokens.toLocaleString()}</div>
                                    <div style="font-size:14px;color:#10b981;font-weight:600;">ÊàêÊú¨: ${stat.total_cost.toFixed(4)} ${currency}</div>
                                    <div style="font-size:12px;color:var(--text-secondary);margin-top:5px;">ÊÄªÊñáÁ´†Êï∞: ${stat.total_articles}</div>
                                </div>
                            `;
                        });
                    }
                    summaryHtml += '</div>';
                    document.getElementById('aiStatsSummary').innerHTML = summaryHtml;

                    let recentHtml = '';
                    if (recentCalls.length === 0) {
                        recentHtml = '<p style="text-align:center;color:#999;">ÊöÇÊó†Ë∞ÉÁî®ËÆ∞ÂΩï</p>';
                    } else {
                        recentCalls.forEach(call => {
                            const date = new Date(call.created_at * 1000).toLocaleString('zh-CN');
                            const currency = call.provider === 'gemini' ? 'USD' : 'CNY';
                            recentHtml += `
                                <div style="background:var(--bg-card);padding:10px;margin-bottom:8px;border-radius:5px;font-size:13px;border:1px solid var(--border-color);">
                                    <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
                                        <span style="font-weight:600;color:var(--text-primary);">${call.provider} / ${call.model}</span>
                                        <span style="color:var(--text-secondary);">${date}</span>
                                    </div>
                                    <div style="color:var(--text-secondary);">
                                        Token: ${call.input_tokens}/${call.output_tokens}/${call.total_tokens} | 
                                        ÊàêÊú¨: ${call.estimated_cost.toFixed(6)} ${currency} | 
                                        ÊñáÁ´†: ${call.article_count} ÁØá
                                    </div>
                                </div>
                            `;
                        });
                    }
                    document.getElementById('aiStatsRecent').innerHTML = recentHtml;

                    document.getElementById('aiStatsLoading').style.display = 'none';
                    document.getElementById('aiStatsContainer').style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to load AI stats:', error);
                document.getElementById('aiStatsLoading').textContent = 'Âä†ËΩΩÂ§±Ë¥•';
            }
        }

        // Export feeds
        async function exportFeeds(format) {
            try {
                const url = `/api/feeds/export/${format}`;
                const link = document.createElement('a');
                link.href = url;
                link.download = `rss-feeds-${Date.now()}.${format === 'opml' ? 'opml' : 'json'}`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showMessage('feedsMessage', `‚úÖ ÊàêÂäüÂØºÂá∫ ${format.toUpperCase()} Ê†ºÂºè`, 'success');
            } catch (error) {
                showMessage('feedsMessage', `‚ùå ÂØºÂá∫Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Import feeds
        async function importFeeds() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];

            if (!file) return;

            try {
                const text = await file.text();
                let format = 'json';

                if (file.name.endsWith('.opml') || file.name.endsWith('.xml') || text.trim().startsWith('<?xml')) {
                    format = 'opml';
                }

                const response = await fetch('/api/feeds/import', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: text, format })
                });

                const result = await response.json();

                if (result.success) {
                    const { added, skipped, errors } = result.data;
                    let message = `‚úÖ ÂØºÂÖ•ÂÆåÊàê: Êñ∞Â¢û ${added} ‰∏™ËÆ¢ÈòÖÊ∫ê`;
                    if (skipped > 0) message += `, Ë∑≥Ëøá ${skipped} ‰∏™ÈáçÂ§ç`;
                    if (errors.length > 0) message += `, ${errors.length} ‰∏™ÈîôËØØ`;

                    showMessage('feedsMessage', message, added > 0 ? 'success' : 'info');

                    if (errors.length > 0) {
                        console.error('Import errors:', errors);
                    }

                    if (added > 0) {
                        await loadFeeds();
                        await loadStats();
                    }
                } else {
                    showMessage('feedsMessage', `‚ùå ÂØºÂÖ•Â§±Ë¥•: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage('feedsMessage', `‚ùå ÂØºÂÖ•Â§±Ë¥•: ${error.message}`, 'error');
            } finally {
                fileInput.value = '';
            }
        }

        // Batch management functions

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.feed-checkbox');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            document.getElementById('selectedCount').textContent = checkedCount;
            document.getElementById('batchDeleteBtn').disabled = checkedCount === 0;
        }

        function selectAllFeeds() {
            const checkboxes = document.querySelectorAll('.feed-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach(cb => cb.checked = !allChecked);
            updateSelectedCount();
            document.getElementById('selectAllBtn').textContent = allChecked ? '‚òëÔ∏è ÂÖ®ÈÄâ' : '‚¨ú ÂèñÊ∂àÂÖ®ÈÄâ';
        }

        function selectErrorFeeds() {
            const checkboxes = document.querySelectorAll('.feed-checkbox');
            checkboxes.forEach(cb => {
                const feedId = parseInt(cb.dataset.feedId);
                cb.checked = errorFeedIds.has(feedId);
            });
            updateSelectedCount();
        }

        async function checkErrorFeeds() {
            if (!confirm('Âç≥Â∞ÜÊ£ÄÊü•ÊâÄÊúâËÆ¢ÈòÖÊ∫êÁöÑËøûÈÄöÊÄß,ËøôÂèØËÉΩÈúÄË¶ÅËæÉÈïøÊó∂Èó¥,ÊòØÂê¶ÁªßÁª≠?')) {
                return;
            }

            showMessage('feedsMessage', 'Ê≠£Âú®Ê£ÄÊü•ÊâÄÊúâËÆ¢ÈòÖÊ∫ê...', 'info');

            try {
                const response = await fetch('/api/feeds/check-errors', {
                    method: 'POST'
                });
                const result = await response.json();

                if (result.success) {
                    const { total, ok, error, results } = result.data;

                    errorFeedIds.clear();
                    results.forEach(r => {
                        if (r.status === 'error') {
                            errorFeedIds.add(r.id);
                        }
                    });

                    if (error > 0) {
                        document.getElementById('selectErrorBtn').style.display = 'inline-block';
                        showMessage('feedsMessage', `Ê£ÄÊü•ÂÆåÊàê! ÂèëÁé∞ ${error} ‰∏™ÈîôËØØÊ∫ê,ÁÇπÂáª"ÈÄâÊã©ÈîôËØØÊ∫ê"ÊåâÈíÆÂø´ÈÄüÈÄâÊã©`, 'error');
                    } else {
                        document.getElementById('selectErrorBtn').style.display = 'none';
                        showMessage('feedsMessage', 'Ê£ÄÊü•ÂÆåÊàê! ÊâÄÊúâËÆ¢ÈòÖÊ∫êÁä∂ÊÄÅÊ≠£Â∏∏ ‚úÖ', 'success');
                    }

                    console.log('ËÆ¢ÈòÖÊ∫êÊ£ÄÊü•ÁªìÊûú:', results);

                    results.forEach(r => {
                        const feedItem = document.querySelector(`[data-feed-id="${r.id}"]`);
                        if (feedItem) {
                            if (r.status === 'error') {
                                feedItem.classList.add('error');
                                feedItem.dataset.hasError = 'true';
                            } else {
                                feedItem.classList.remove('error');
                                feedItem.dataset.hasError = 'false';
                            }
                        }
                    });
                } else {
                    showMessage('feedsMessage', 'Ê£ÄÊü•Â§±Ë¥•: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Ê£ÄÊü•ÈîôËØØÊ∫êÂ§±Ë¥•:', error);
                showMessage('feedsMessage', 'Ê£ÄÊü•Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        async function batchDeleteFeeds() {
            const checkboxes = document.querySelectorAll('.feed-checkbox:checked');
            const selectedIds = Array.from(checkboxes).map(cb => parseInt(cb.dataset.feedId));

            if (selectedIds.length === 0) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑËÆ¢ÈòÖÊ∫ê');
                return;
            }

            if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} ‰∏™ËÆ¢ÈòÖÊ∫êÂêó?\n\nÊ≠§Êìç‰ΩúÂ∞ÜÂêåÊó∂Âà†Èô§Ëøô‰∫õÊ∫êÁöÑÊâÄÊúâÊñáÁ´†,‰∏îÊó†Ê≥ïÊí§ÈîÄ!`)) {
                return;
            }

            showMessage('feedsMessage', `Ê≠£Âú®Âà†Èô§ ${selectedIds.length} ‰∏™ËÆ¢ÈòÖÊ∫ê...`, 'info');

            try {
                const response = await fetch('/api/feeds/batch-delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ids: selectedIds })
                });
                const result = await response.json();

                if (result.success) {
                    const { deleted, failed, results } = result.data;

                    if (failed > 0) {
                        let errorMsg = `Âà†Èô§ÂÆåÊàê: ÊàêÂäü ${deleted} ‰∏™, Â§±Ë¥• ${failed} ‰∏™\n\nÂ§±Ë¥•ÂàóË°®:\n`;
                        results.failed.forEach(f => {
                            errorMsg += `#${f.id}: ${f.error}\n`;
                        });
                        showMessage('feedsMessage', errorMsg, 'error');
                    } else {
                        showMessage('feedsMessage', `ÊàêÂäüÂà†Èô§ ${deleted} ‰∏™ËÆ¢ÈòÖÊ∫ê ‚úÖ`, 'success');
                    }

                    await loadFeeds();
                    await loadStats();
                    updateSelectedCount();
                } else {
                    showMessage('feedsMessage', 'ÊâπÈáèÂà†Èô§Â§±Ë¥•: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('ÊâπÈáèÂà†Èô§Â§±Ë¥•:', error);
                showMessage('feedsMessage', 'ÊâπÈáèÂà†Èô§Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Logs Management
        let logFilter = 'all';
        let logsSortedNewestFirst = false;
        let autoRefreshInterval = null;

        function toggleLogSort() {
            logsSortedNewestFirst = document.getElementById('sortLogsToggle').checked;
            // ‰øùÂ≠òÁî®Êà∑ÂÅèÂ•ΩËÆæÁΩÆ
            localStorage.setItem('logsSortNewestFirst', logsSortedNewestFirst ? 'true' : 'false');
            loadLogs();
        }

        // ÂàùÂßãÂåñÊó•ÂøóÊéíÂ∫èËÆæÁΩÆ
        function initializeLogSettings() {
            const savedSortPreference = localStorage.getItem('logsSortNewestFirst');
            if (savedSortPreference === 'true') {
                logsSortedNewestFirst = true;
                const toggleElement = document.getElementById('sortLogsToggle');
                if (toggleElement) {
                    toggleElement.checked = true;
                }
            }
        }

        async function loadLogs() {
            try {
                const response = await fetch('/api/logs?limit=200');
                const result = await response.json();

                if (result.success) {
                    let logs = result.data;
                    const logsContent = document.getElementById('logsContent');
                    const logsCount = document.getElementById('logsCount');

                    if (logs.length === 0) {
                        logsContent.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">ÊöÇÊó†Êó•ÂøóËÆ∞ÂΩï</div>';
                        logsCount.textContent = '0';
                        return;
                    }

                    // ËøáÊª§Êó•Âøó
                    let filteredLogs = logFilter === 'all' ? logs : logs.filter(log => log.level === logFilter);

                    // ÊéíÂ∫èÊó•Âøó
                    if (logsSortedNewestFirst) {
                        filteredLogs.reverse();
                    }

                    // ÁîüÊàêHTML
                    const logsHtml = filteredLogs.map(log => {
                        const colors = {
                            'info': '#4EC9B0',
                            'warn': '#CE9178',
                            'error': '#F48771',
                            'debug': '#9CDCFE'
                        };
                        const color = colors[log.level] || '#d4d4d4';
                        const icon = {
                            'info': '‚ÑπÔ∏è',
                            'warn': '‚ö†Ô∏è',
                            'error': '‚ùå',
                            'debug': 'üîç'
                        }[log.level] || 'üìù';

                        return `
                            <div style="margin-bottom: 8px; padding: 8px; border-left: 3px solid ${color}; background: rgba(255,255,255,0.03); border-radius: 4px;">
                                <div style="display: flex; gap: 10px; align-items: flex-start;">
                                    <span style="color: #858585; font-size: 12px; min-width: 140px;">${log.time}</span>
                                    <span style="color: ${color}; font-weight: 600; min-width: 50px;">${icon} ${log.level.toUpperCase()}</span>
                                    <span style="flex: 1; word-break: break-word;">${escapeHtml(log.message)}</span>
                                </div>
                            </div>
                        `;
                    }).join('');

                    logsContent.innerHTML = logsHtml || '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">Ê≤°ÊúâÁ¨¶ÂêàÊù°‰ª∂ÁöÑÊó•Âøó</div>';
                    logsCount.textContent = filteredLogs.length;

                    // ÊªöÂä®
                    const container = document.getElementById('logsContainer');
                    if (logsSortedNewestFirst) {
                        container.scrollTop = 0;
                    } else {
                        container.scrollTop = container.scrollHeight;
                    }
                }
            } catch (error) {
                console.error('Failed to load logs:', error);
                document.getElementById('logsContent').innerHTML = '<div style="color: #F48771;">‚ùå Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•: ' + error.message + '</div>';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function filterLogs(filter) {
            logFilter = filter;

            // Êõ¥Êñ∞ÊåâÈíÆÊ†∑Âºè
            const buttons = document.querySelectorAll('#logFilterButtons .btn');
            const filterMap = ['all', 'info', 'warn', 'error'];
            const activeClasses = ['btn-primary', 'btn-primary', 'btn-warning', 'btn-danger'];

            buttons.forEach((btn, index) => {
                if (filterMap[index] === filter) {
                    btn.className = `btn btn-sm ${activeClasses[index]}`;
                } else {
                    btn.className = 'btn btn-sm btn-outline';
                }
            });

            loadLogs();
        }

        async function clearLogs() {
            if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊó•ÂøóÂêóÔºü')) return;

            try {
                const response = await fetch('/api/logs/clear', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    loadLogs();
                    alert('‚úÖ Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫');
                }
            } catch (error) {
                alert('‚ùå Ê∏ÖÁ©∫Êó•ÂøóÂ§±Ë¥•: ' + error.message);
            }
        }

        function toggleAutoRefresh() {
            const enabled = document.getElementById('autoRefreshLogs').checked;

            if (enabled) {
                loadLogs(); // Á´ãÂç≥Âä†ËΩΩ‰∏ÄÊ¨°
                autoRefreshInterval = setInterval(loadLogs, 3000); // ÊØè3ÁßíÂà∑Êñ∞
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');

            // Update desktop toggle switch
            const desktopToggle = document.getElementById('darkModeToggle');
            if (desktopToggle) {
                desktopToggle.checked = isDark;
            }

            // Update desktop icon and text
            const desktopIcon = document.getElementById('darkModeIcon');
            const desktopText = document.getElementById('darkModeText');
            if (desktopIcon && desktopText) {
                if (isDark) {
                    desktopIcon.className = 'fas fa-sun';
                    desktopText.textContent = 'ÊµÖËâ≤Ê®°Âºè';
                } else {
                    desktopIcon.className = 'fas fa-moon';
                    desktopText.textContent = 'ÈªëÊöóÊ®°Âºè';
                }
            }

            // Update mobile icon
            const mobileButtonIcon = document.querySelector('#mobile-dark-mode-toggle i');
            if (mobileButtonIcon) {
                mobileButtonIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }

            // Save preference
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
        }

        // Initialize dark mode from localStorage
        function initializeDarkMode() {
            const darkMode = localStorage.getItem('darkMode');
            const isDark = (darkMode === 'enabled');

            if (isDark) {
                document.body.classList.add('dark-mode');
            }

            // Update desktop toggle switch
            const desktopToggle = document.getElementById('darkModeToggle');
            if (desktopToggle) {
                desktopToggle.checked = isDark;
            }

            // Update desktop icon and text
            const desktopIcon = document.getElementById('darkModeIcon');
            const desktopText = document.getElementById('darkModeText');
            if (desktopIcon && desktopText) {
                if (isDark) {
                    desktopIcon.className = 'fas fa-sun';
                    desktopText.textContent = 'ÊµÖËâ≤Ê®°Âºè';
                } else {
                    desktopIcon.className = 'fas fa-moon';
                    desktopText.textContent = 'ÈªëÊöóÊ®°Âºè';
                }
            }

            // Update mobile icon
            const mobileButtonIcon = document.querySelector('#mobile-dark-mode-toggle i');
            if (mobileButtonIcon) {
                mobileButtonIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
        }

        // Initialize
        // Restore last active tab from localStorage or URL hash
        function initializeTabs() {
            const hash = window.location.hash.substring(1); // Remove '#'
            const savedTab = localStorage.getItem('currentTab');
            const defaultTab = 'dashboard';

            // Priority: URL hash > localStorage > default
            let activeTab = hash || savedTab || defaultTab;

            // Validate tab exists
            const validTabs = ['dashboard', 'feeds', 'ai-settings', 'system', 'stats', 'logs'];
            if (!validTabs.includes(activeTab)) {
                activeTab = defaultTab;
            }

            // Set active tab
            const activeLink = document.querySelector(`.sidebar-menu a[href="#${activeTab}"]`);
            if (activeLink) {
                // Remove all active states
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    link.classList.remove('active');
                });
                // Set active state
                activeLink.classList.add('active');

                // Update page title
                const titles = {
                    'dashboard': '‰ª™Ë°®Áõò',
                    'feeds': 'ËÆ¢ÈòÖÊ∫êÁÆ°ÁêÜ',
                    'ai-settings': 'AI ÊÄªÁªìËÆæÁΩÆ',
                    'system': 'Á≥ªÁªüËÆæÁΩÆ',
                    'stats': '‰ΩøÁî®ÁªüËÆ°',
                    'logs': 'ËøêË°åÊó•Âøó'
                };
                document.querySelector('.page-title').textContent = titles[activeTab];

                // Show active tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(activeTab + '-tab').classList.add('active');

                // Save to localStorage
                localStorage.setItem('currentTab', activeTab);
            }
        }

        initializeDarkMode();
        initializeTabs();
        initializeLogSettings(); // ÂàùÂßãÂåñÊó•ÂøóËÆæÁΩÆ
        loadStats();
        loadFeeds();
        loadAISettings();
        loadAIStats();
        updateInitModeHint();

        const aiContent = document.getElementById('aiContent');
        if (aiContent && aiContent.classList.contains('collapsed')) {
            aiContent.classList.remove('collapsed');
        }

        setInterval(loadStats, 30000);
        setInterval(loadAIStats, 60000);
    </script>
</body>

</html>